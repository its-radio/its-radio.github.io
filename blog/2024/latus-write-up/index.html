<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> HTB Write-Up | Hard Sherlock | Latus | Edmund Hughes </title> <meta name="author" content="Edmund Hughes"> <meta name="description" content="A write-up for Hack The Box's forensics challenge 'Latus'"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?a27bdb63fce2b854f99c6ed2387b5fa8"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://its-radio.github.io/blog/2024/latus-write-up/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <img src="/assets/img/logo/radio-logo-512.png" alt="Logo" style="height: 40px; margin-right: 0px; margin-bottom: 15px;"> <img src="/assets/img/logo/name-gradient.png" alt="Logoname" style="height: 25px; margin-right: 10px; margin-bottom: 8px;"> <span class="font-weight-bold">Edmund</span> Hughes </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/about/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">HTB Write-Up | Hard Sherlock | Latus</h1> <p class="post-meta"> Created in December 15, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/forensics"> <i class="fa-solid fa-hashtag fa-sm"></i> forensics</a>   <a href="/blog/tag/hard"> <i class="fa-solid fa-hashtag fa-sm"></i> hard</a>   <a href="/blog/tag/sherlock"> <i class="fa-solid fa-hashtag fa-sm"></i> sherlock</a>   <a href="/blog/tag/hackthebox"> <i class="fa-solid fa-hashtag fa-sm"></i> HackTheBox</a>   ·   <a href="/blog/category/write-ups"> <i class="fa-solid fa-tag fa-sm"></i> Write-Ups</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <style>.small-margin>*{margin-bottom:.1rem}</style> <h2 id="introduction">Introduction</h2> <p>This is a write-up for Hack The Box’s Sherlock challenge <strong>Latus</strong>, which is rated as <strong>Hard</strong>. It was relatively difficult, as reflected by the fact that I was only the 42nd person to solve it after it had been out for several months. For context, an easy Sherlock that I did a write-up for had something like 75 solves the day after it came out and now, a few months later, it has over 1000 solves.</p> <p>That being said, I think this is a great challenge and I would encourage anyone to jump into a challenge like this one. I think diving in a little over your head in digital forensics is a fantastic way to learn and expose yourself to new topics.</p> <p>For this demo I’m using one machine running Fedora 40 and one running Windows 11 depending on the tools I need to access different information.</p> <h3 id="the-scenario">The Scenario</h3> <p>As always with CTFs, let’s start by carefully reading the scenario description to see what we are working with.</p> <p><em>“Our customer discovered illegal RDP sessions without Privileged Access Management (PAM) in their system on June 28. They collected evidence on a server they suspected was an intermediary server to move laterally to others. Even though the attacker deleted the event log, I believe the few remaining artifacts are enough to help confirm the attack flow and trace the attacker’s behavior.”</em></p> <p>What do we learn here?</p> <ol> <li>The initial malicious activity that was noted were RDP sessions, giving us a protocol to focus on.</li> <li>The activity we are interested in was discovered on June 28th, so we should start with evidence that fits that timeframe.</li> <li>The customer suspects that the target server was being used as a pivot host, implying it wasn’t the attacker’s ultimate objective.</li> <li>The event logs have been deleted, so we will be working with other types of forensic evidence, not logs.</li> </ol> <h3 id="the-evidence">The Evidence</h3> <p>Now let’s take a look at the evidence. If you are having trouble with the basics like downloading and decompressing the evidence, take a look at the beginning of <a href="/blog/2024/Compromised-Write-Up/">this other post</a> where I describe how to do that.</p> <p>After decompressing the evidence, we’re left with a single file: <code class="language-plaintext highlighter-rouge">evidence.ad1</code></p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/4.png" sizes="95vw"></source> <img src="/assets/img/latus/4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Full transparency, even after completing the entire CDSA course from HTB and completing a masters degree in cybersecurity, I had not heard of .ad1 files. In fact, I double checked the CDSA course to make sure I hadn’t missed it and “.ad1” doesn’t come up in a search of the materials on HTB Academy.</p> <p>Nothing that a quick google search can’t fix though. It turns out that .ad1 is an extension used for a proprietary format, similar to a container according to <a href="https://dfir.science/2021/09/What-is-an-AD1.html" rel="external nofollow noopener" target="_blank">DIFR Science</a>. No need to get into the nitty gritty here, but it should suffice to say that it is a type of forensic image and we will need some specific software to be able to interact with it.</p> <p>To open <code class="language-plaintext highlighter-rouge">evidence.ad1</code> we will need to use FTK Imager, which can be found in Exterro’s <a href="https://www.exterro.com/ftk-product-downloads" rel="external nofollow noopener" target="_blank">downloads section</a>. It needs to be installed on Windows. You could probably run it on Linux via Wine, but for simplicity’s sake, I just booted up a windows system and installed it there.</p> <p>Once you open up FTK Imager, just <strong>file -&gt; Add Evidence Item</strong>. In the pop-up window, select <strong>Image File -&gt; next</strong>, then browse to wherever you <code class="language-plaintext highlighter-rouge">evidence.ad1</code> and click finish. Expand the tabs on the left-hand side to see the image contents. It should look like this upon loading in correctly.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/6.png" sizes="95vw"></source> <img src="/assets/img/latus/6.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>From here, it’s possible to browse the contents of the image to some extent and export certain files if closer examination is necessary. We are ready to hop into Task 1.</p> <h2 id="task-1-when-was-the-last-failed-logon-attempt-using-emmant-user--utc">Task 1: When was the last failed logon attempt using <strong>emman.t</strong> user? (UTC)</h2> <p>Normally, this would be where I reach for Windows Security logs and look for Event ID 4625s, but as the description said, the attackers deleted the logs. I checked the logs nonetheless just to make sure. While there actually are a few entries in the logs on the forensic image, there is nothing there to answer this question.</p> <p>Okay, so where else might there be evidence of failed logons? The SAM (Security Account Manager) Hive in the registry holds information related to accounts, including a limited amount of their logon activity. I exported the SAM hive like this:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/10a.png" sizes="95vw"></source> <img src="/assets/img/latus/10a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It is also worth exporting the <code class="language-plaintext highlighter-rouge">SAM.LOG1</code> and <code class="language-plaintext highlighter-rouge">SAM.lOG2</code> files from the same directory as they store transaction information for the SAM hive and can allow us to see, for example, registry keys and values that have been deleted.</p> <p>Then I opened it using the <em>Registry Explorer</em> from Eric Zimmerman’s (EZ) <em>EZ-Tools</em> suite. If you don’t have them, I’d recommend just using his script provided in the <em>Get-ZimmermanTools.zip</em> that is available on his <a href="https://ericzimmerman.github.io/#!index.m" rel="external nofollow noopener" target="_blank">github pages site</a>.</p> <p>I loaded the SAM hive into <em>Registry Explorer</em>, then poked around a bit. At first I wasted some time searching through paths to information about individual users, but the answer turned out to be in a more obvious spot–directly in <code class="language-plaintext highlighter-rouge">SAM\Domains\Accounts\Users</code>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/11.png" sizes="95vw"></source> <img src="/assets/img/latus/11.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-2-what-are-the-first-3-ip-addresses-that-emmant-connected-to-using-remote-desktop-rdp">Task 2: What are the first 3 IP addresses that emman.t connected to using Remote Desktop (RDP)?</h2> <p>Sticking with the registry, RDP information in the registry is stored under the name <em>Terminal Server Client</em>. I first looked in the SOFTWARE Hive to no avail. However, it turned out that the information I was after was stored in <strong>**emman.t</strong>**’s personal hive, <code class="language-plaintext highlighter-rouge">NTUSER.DAT</code>. Each user has such a hive located in their home directory to store personal registry items.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/11a.png" sizes="95vw"></source> <img src="/assets/img/latus/11a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><strong>Note about the <code class="language-plaintext highlighter-rouge">&lt;hive&gt;.LOG1</code> &amp; <code class="language-plaintext highlighter-rouge">&lt;hive&gt;.LOG2</code> files:</strong> <em>When you load a hive, Registry Explorer should prompt you if you need to use the log files to replay the transaction history. If it prompts you, just go ahead and do it and save the new “clean” version too for later use. It will also ask you if you want to view the “dirty” version of the hive. You really don’t have to unless you specifically want to compare before and after the transaction logs replay. Just view the “clean” versions most of the time.</em></p> <p>After loading it into Registry Explorer as before, we can see the locate <em>Terminal Server Client</em> at <code class="language-plaintext highlighter-rouge">NTUSER.DAT/SOFTWARE/Microsoft/Terminal Server Client</code>. I found the IPs listed in the <code class="language-plaintext highlighter-rouge">Server</code> key. There are a lot of times, so it’s useful here to just sort by time and take the earliest three.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/15.png" sizes="95vw"></source> <img src="/assets/img/latus/15.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-3-what-is-the-destination-username-used-to-remote-desktop-to-for-the-first-time-on-2024-06-20-160105-utc">Task 3: What is the destination username used to remote desktop to for the first time on 2024-06-20 16:01:05 UTC?</h2> <p>Another RDP question and we’re already in the right place! Just look for the matching timestamp in the list of IPs from the last question and look at its subkeys. One of the values should jump out as looking like a username.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/16.png" sizes="95vw"></source> <img src="/assets/img/latus/16.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-4-what-is-the-destination-ip-address-of-the-last-remote-desktop-rdp-session">Task 4: What is the destination IP address of the last Remote Desktop (RDP) session?</h2> <p>Yet another RDP question that is answerable from this location. Sort by time in the other direction this time to see the last RDP session.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/17.png" sizes="95vw"></source> <img src="/assets/img/latus/17.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I’m not sure why the answer is the one that takes place on 2024-06-26 rather than the one that takes place on 2024-06-28, which is clearly a later time. Was this just HTB messing up or is there an explanation for this? If you know, reach out to <a href="https://x.com/its_rad_io" rel="external nofollow noopener" target="_blank">me on X</a> and let me know your theory.</p> <h2 id="task-5-emmant-is-very-careless-in-always-saving-rdp-credentials-to-connect-to-other-hosts-so-we-believe-that-attacker-somehow-leaked-them-please-confirm-credentials-of-the-server-with-ip-19216870133-that-was-leaked">Task 5: emman.t is very careless in always saving RDP credentials to connect to other hosts, so we believe that attacker somehow leaked them. Please confirm credentials of the server with ip 192.168.70.133 that was leaked?</h2> <p>Man, this one threw me for a loop for the longest time. In fact, during my initial solve, this was chronologically the last Task that I solved.</p> <p>First I identified which credentials I was meant to be looking for. For that it’s back (yet again) to the <strong>**emman.t</strong>**’s Terminal Client Server key\Servers key. Examine the subkeys of 192.168.70.133 to find the username of the account the question is asking about: <code class="language-plaintext highlighter-rouge">HQ-DOM-03\Administrator</code>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/27a.png" sizes="95vw"></source> <img src="/assets/img/latus/27a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Even though some of the following methods didn’t lead directly to a correct answer, I’ll list a few techniques that I tried before landing on the path that worked. Not only were they worth trying, but some of them resulted in information that was important in determining how to proceed in this task and others.</p> <p>Before starting this, I mass exported everything from the <code class="language-plaintext highlighter-rouge">evidence.ad1</code> image and moved it back to a Linux machine so that I could more easily search through the contents of files.</p> <h3 id="1-i-used-various-grep-and-strings-methods-to-search-through-the-files-for-keywords">1. I used various <code class="language-plaintext highlighter-rouge">grep</code> and <code class="language-plaintext highlighter-rouge">strings</code> methods to search through the files for keywords.</h3> <p>Here, I grep for files that contain ‘Administrator’, then dump the strings of those files (since many were binary files), pipe the result back to grep, search for ‘Administrator’ again, returning 20 lines on either side of a match, and then search for instances of ‘password’ in those results. I did a bunch of variations of this type of search.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/21.png" sizes="95vw"></source> <img src="/assets/img/latus/21.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Since the question is asking about <strong>emman.t</strong>, I also spent some time filtering for that username to see where it came up in files andI ended up finding some very interesting results in <code class="language-plaintext highlighter-rouge">consoleHost_history.txt</code> which is a powershell log stored at:</p> <pre><code class="language-plain">C:\Users\&lt;user&gt;\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
</code></pre> <p>This is what it showed for user <strong>emman.t</strong>:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/26.png" sizes="95vw"></source> <img src="/assets/img/latus/26.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>What the above image shows is the <strong>emman</strong> user being created with the password <strong>emman2024</strong>. That’s very interesting, but those aren’t the credentials we are asked for in this question. Still, note them for later.</p> <p>While searching for “192.168.70.133”, “rdp”, “terminal client server”, “tsc”, etc. I ran across the following interesting files. They may play a part later:</p> <ol> <li>C:/Users/emman.t/Documents/Default.rdp</li> <li>C:/Users/emman/Documents/Default.rdp</li> <li>C:/Users/emman.t/AppData/Local/Microsoft/Terminal Server Client/Cache/Cache0000.bin</li> <li>C:/Users/emman.t/AppData/Local/Microsoft/Terminal Server Client/Cache/Cache0001.bin</li> <li>C:/Users/emman.t/AppData/Local/Microsoft/Terminal Server Client/Cache/Cache0002.bin</li> </ol> <h3 id="2-i-ran-secrectsdumppy-a-part-of-impacket-to-dump-credentials-from-the-registry">2. I ran secrectsdump.py (a part of <a href="https://github.com/fortra/impacket" rel="external nofollow noopener" target="_blank">Impacket</a>) to dump credentials from the registry</h3> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/27.png" sizes="95vw"></source> <img src="/assets/img/latus/27.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Even though we can’t directly see the passwords, we can still glean some information. The LM hashes all have an empty value, indicating that LM hashing is disabled. This is good from a defensive point of view because LM hashes are very weak and vulnerable to brute force or rainbow table attacks. More importantly though we can see the <strong>emman</strong> and <strong>emman.t</strong> have the exact same NT hash, meaning that their passwords are the same as each other. Since we know <strong>emman</strong>’s password is <strong>emman2024</strong>, we now know that must be <strong>emman.t</strong>’s password as well.</p> <h3 id="3-i-looked-in-the-mft-to-see-which-files-were-accessed-around-the-time-of-the-last-session-with-19216870133">3. I looked in the $MFT to see which files were accessed around the time of the last session with 192.168.70.133</h3> <p>The Master File Table (MFT) stores file metadata and EZ-Tools includes some tools that make the MFT easy to parse. The MFT can contain evidence all on its own, but I often find myself using it as a quick way to query the file system to see if different files exist, where they reside on the filesystem, or when they were last edited or accessed. For this purpose I use EZ’s <em>Timeline Explorer</em></p> <p>First, you need to create a .csv file from the <strong>$MFT</strong> using EZ’s <code class="language-plaintext highlighter-rouge">MFTECmd.exe</code> like this:</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="n">\MFTECmd.exe</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="s1">'C:\Users\&lt;user&gt;\Desktop\HackTheBox\latus\ftk-file-export\C___NONAME [NTFS]\C\$MFT'</span><span class="w"> </span><span class="nt">--csv</span><span class="w"> </span><span class="nx">C:\Users\</span><span class="err">&lt;</span><span class="nx">user</span><span class="err">&gt;</span><span class="nx">\Desktop\HackTheBox\latus\</span><span class="w"> </span><span class="nt">--csvf</span><span class="w"> </span><span class="nx">mft.csv</span><span class="w">
</span></code></pre></div></div> <p>Make sure to replace the paths with your own.</p> <p>Next, open the new .csv file up in EZ’s <em>Timeline Explorer</em>. Now we have a timeline showing when all the files were last edited, accessed, etc., but what time are we interested in? Specifically, we are interested in the time around the last RDP session with 192.168.70.133. We actually already know that time from the first screenshot in this Task (Task 5). The record about the session was written to the registry at time <code class="language-plaintext highlighter-rouge">2024-06-26 08:34:08</code>.</p> <p>Our hypothesis is that around this time credentials must have been accessed somehow to initiate the session, so if we can identify which files were accessed at this time, we should be able to narrow down the possible locations of the credentials.</p> <p>Navigating near <code class="language-plaintext highlighter-rouge">2024-06-26 08:34:08</code> in Timeline Explorer, I noticed some files with ‘credentials’ in their path. Time correlated credential access. Interesting.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25.png" sizes="95vw"></source> <img src="/assets/img/latus/25.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>A credential was cached on the system just seconds before the record on 192.168.70.133 was written to the registry. It is a pretty good bet that this file will contain the credential we are looking for. It’s just a matter of finding a way to decrypt the credential file’s contents.</p> <h3 id="4-finally-i-researched-the-credential-type-extracted-it-using-mimikatz-and-finished-the-task">4. Finally, I researched the credential type, extracted it using Mimikatz, and finished the Task</h3> <p>DPAPI is the Data Protection API and is responsible for encrypting and storing credentials that need to be cached for each user. It’s been a while since I learned about DPAPI, so I read up on it and how to extract credentials from DPAPI-encrypted files on <a href="https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords.html" rel="external nofollow noopener" target="_blank">HackTricks</a> among other sources. This <a href="https://posts.specterops.io/operational-guidance-for-offensive-user-dpapi-abuse-1fb7fac8b107" rel="external nofollow noopener" target="_blank">excellent post</a> by Will Schroeder of SpecterOps really gave me what I needed to tackle the rest of this Task.</p> <p>Here is what I learned: Credential files each store a single credential and are encrypted using the user’s password regardless of the credential they store. That’s good news for two reasons. First, it means that the credential file that is time-correlated with the RDP session likely holds only the credential we are looking for. Second, we already have the user’s password. Remember? This credential is associated with <strong>emman.t</strong>. We found <strong>emman</strong>’s password in <code class="language-plaintext highlighter-rouge">consoleHost_history.txt</code> and then later noticed that his NT hash matched <strong>emman.t</strong>’s, revealing his password. We have the encrypted credential file, we have <strong>emman.t</strong>’s encrypted master key files, and we have the password that should decrypt the master keys. Let’s get hacking.</p> <p>It turns out that <a href="https://github.com/gentilkiwi/mimikatz" rel="external nofollow noopener" target="_blank">Mimikatz</a> has the ability to dump the credentials from a DPAPI-encrypted credential. Extracting it felt a bit complicated at first but it really is not too bad once it’s broken down. Accessing the password stored in the credential file requires a DPAPI master key. Accessing the DPAPI master key requires the password of the user for whom the credential file was made (i.e. <strong>emman.t</strong>), not the user whose credentials are store in the credential file (i.e. <strong>HQ-DOM-03\Administrator</strong>). The layers of encryption look something like this:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25a.png" sizes="95vw"></source> <img src="/assets/img/latus/25a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We already know <strong>emman.t</strong>’s password, so we can decrypt the master key, and if we can do that, then we should be able to decrypt the credential file.</p> <p>Windows Credential Manager cached credentials are stored here:</p> <pre><code class="language-plain">C:\Users\&lt;user&gt;\AppData\Local\Microsoft\Credentials\
</code></pre> <p>The one we are interested in (identified by timestamp in the MFT) is this one:</p> <pre><code class="language-plain">C:\Users\emman.t\AppData\Local\Microsoft\Credentials\063D7EF36287654137F1E552FF79E61E
</code></pre> <p>DPAPI keys are cached here:</p> <pre><code class="language-plain">C:\Users\&lt;user&gt;\AppData\Roaming\Microsoft\Protect\&lt;user SID&gt;\
</code></pre> <h4 id="identify-the-dpapi-master-key">Identify the DPAPI master key</h4> <p>We don’t know which one we need yet, but Mimikatz will help us identify the correct one. Run the Mimikatz CLI on the machine where you have stored the files dumped from the forensic image. Use the following command (as always, remember to adjust the paths for your environment):</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dpapi::cred</span><span class="w"> </span><span class="nx">/in:</span><span class="s2">"C:\&lt;path to files from forensic image&gt;\C\Root\Users\emman.t\AppData\Local\Microsoft\Credentials\063D7EF36287654137F1E552FF79E61E"</span><span class="w">
</span></code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25b.png" sizes="95vw"></source> <img src="/assets/img/latus/25b.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We can identify the master key that we care about from the output:</p> <pre><code class="language-plain">C\root\Users\emman.t\AppData\Roaming\Microsoft\Protect\S-1-5-21-1281496067-1440983016-2272511217-1000\ac986fb1-8431-4749-bc7b-92ecdf5d7d64
</code></pre> <h4 id="dump-the-master-key">Dump the master key</h4> <p>Still in Mimikatz, dump the master key using the following command:</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dpapi::masterkey</span><span class="w"> </span><span class="nx">/in:</span><span class="s2">"C:\&lt;path to files from forensic image&gt;\C\root\Users\emman.t\AppData\Roaming\Microsoft\Protect\S-1-5-21-1281496067-1440983016-2272511217-1000\ac986fb1-8431-4749-bc7b-92ecdf5d7d64"</span><span class="w"> </span><span class="nx">/password:emman2024</span><span class="w"> </span><span class="nx">/protected</span><span class="w">
</span></code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25c.png" sizes="95vw"></source> <img src="/assets/img/latus/25c.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="dump-the-credential-file">Dump the credential file</h4> <p>Mimikatz is pretty smart, so it caches the master key in memory and will just apply it to other times you run <code class="language-plaintext highlighter-rouge">dpapi::cred</code> within the same session, so you can just rerun:</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dpapi::cred</span><span class="w"> </span><span class="nx">/in:</span><span class="s2">"C:\&lt;path to files from forensic image&gt;\C\Root\Users\emman.t\AppData\Local\Microsoft\Credentials\063D7EF36287654137F1E552FF79E61E"</span><span class="w">
</span></code></pre></div></div> <p>And it should dump the credential. If you got kicked out of the session somehow or you aren’t using the CLI, the full command to dump the cred when the master key isn’t cached in memory is:</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dpapi::cred</span><span class="w"> </span><span class="nx">/in:</span><span class="s2">"C:\Users\Gloria Cuthbertson\Desktop\Exception\C\Root\Users\emman.t\AppData\Local\Microsoft\Credentials\063D7EF36287654137F1E552FF79E61E"</span><span class="w"> </span><span class="nx">/masterkey:5902689a5601048b83a7858a842c20d79abff55d82c6d1a35148cc97533760b212d2354057fe3bbdb4d8fdf0ea6fdd1aa79d8bef0101136ebad6ce0eb73e93e8</span><span class="w">
</span></code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25d.png" sizes="95vw"></source> <img src="/assets/img/latus/25d.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>As shown above, the password is <strong>C@mv@0s3rv3r</strong></p> <h2 id="task-6-when-was-the-last-time-the-remote-desktop-connection-application-was-executed-utc">Task 6: When was the last time the Remote Desktop Connection application was executed? (UTC)</h2> <p>For this we have to identify the final time that the RDP application was executed. Keep in mind that executing it doesn’t necessarily mean that a connection was started at that time.</p> <p>The executable responsible for running RDP connections is called <code class="language-plaintext highlighter-rouge">mstsc.exe</code>. I threw all the files that I extracted from the forensic image into <a href="https://www.autopsy.com/" rel="external nofollow noopener" target="_blank">Autopsy</a>, a powerful forensics toolkit. Autopsy has a ‘Run Programs’ section, which shows the times at which applications were executed. Sort these by name to group all the <code class="language-plaintext highlighter-rouge">mstsc.exe</code>s, then compare them to find the latest time.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25e.png" sizes="95vw"></source> <img src="/assets/img/latus/25e.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This result is correlated with the last-access time of the RDP config file for <strong>emman.t</strong>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/25f.png" sizes="95vw"></source> <img src="/assets/img/latus/25f.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-7-when-was-the-last-time-the-remote-desktop-connection-application-was-terminated-utc">Task 7: When was the last time the Remote Desktop Connection application was terminated? (UTC)</h2> <p>For this one I headed back to the <strong>$MFT</strong>. I figured that an application’s .exe file might be last accessed at the time that it was terminated. Pursuing this, I searched the <strong>$MFT</strong> for <code class="language-plaintext highlighter-rouge">mstsc.exe</code> and looked at its last-accessed timestamp. It also should feasibly match up with the previous answer. That is, it shouldn’t be too much after <code class="language-plaintext highlighter-rouge">2024-06-28 HH:MM:SS</code>.</p> <p>We actually don’t find that specifically <code class="language-plaintext highlighter-rouge">mstsc.exe</code> has been has been accessed, near that time, but one of its resource files, <code class="language-plaintext highlighter-rouge">mstsc.exe.mun</code> was last accessed at <code class="language-plaintext highlighter-rouge">2024-06-28 HH:MM:SS</code> few minutes after the last time that <code class="language-plaintext highlighter-rouge">mstsc.exe</code> was executed.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/35.png" sizes="95vw"></source> <img src="/assets/img/latus/35.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The above image shows the timestamp associated with the mstsc.exe.mun files. </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/35.png" sizes="95vw"></source> <img src="/assets/img/latus/35.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The above image shows file names referenced in the previous image's caption. </div> <p>Now, I’ll be the first to admit that this answer is based on some shakey logic and guess work. I do not definitively know why it is that the timestamp associated with this particular instance <code class="language-plaintext highlighter-rouge">mstsc.exe.mun</code> in $MFT is the answer, and not the timestamp associated with <code class="language-plaintext highlighter-rouge">mstsc.exe</code> itself, or <code class="language-plaintext highlighter-rouge">mstsc.exe.mui</code>, or a different instance of <code class="language-plaintext highlighter-rouge">mstsc.exe.mun</code>, or another associated file. Again, if you have a definitive answer for <em>why</em> this is the correct answer, please let me know.</p> <h2 id="task-8-how-long-did-the-penultimate-rdp-session-last">Task 8: How long did the penultimate RDP session last?</h2> <p>This question is looking for the duration of the second to last RDP session. What we really need here is a start time and an end time for the session. In my chronology of solving this CTF, this question was one of the last solved. There are a lot of different resources to look at and it’s hard to know which ones to focus on for definitive start and end times.</p> <p>Solving Task 9 first is helpful. Solving it means that you have identified at least one method to find the ending timestamp of an RDP session. In fact, I think everything will make more sense if I take the writeup in that direction too. We will return to Task 8 after completing Task 9.</p> <h2 id="task-9-when-did-the-attacker-disconnect-the-last-remote-desktop-rdp-session-utc">Task 9: When did the attacker disconnect the last Remote Desktop (RDP) session? (UTC)</h2> <p>So what would change when an RDP connection disconnects? At first, I expected it to be a credential, something similar to the credential being accessed in Task 5. But its not that. That makes sense right? Credentials are used to initiate a connection, not to terminate one.</p> <p>Returning to some other files we found back in Task 5, we notice some interesting correlations between them.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/59.png" sizes="95vw"></source> <img src="/assets/img/latus/59.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It turns out that the timestamp ending in 3, associated with Default.rdp is the correct answer. I am not sure if its standard for Default.rdp to be modified upon termination of an RDP session, though I don’t think it is. However, it does make sense that the cache associated with an RDP session, <code class="language-plaintext highlighter-rouge">cache0001.bin</code> in this case, would be last modified at the time the session was terminated. The fact that it is off by 1 second could be a rounding issue or simply due to a small discrepancy in the times that different processes occurred when the RDP session terminated.</p> <p>Either way these times were correlated. Even though we can’t see other times that Default.rdp was modified, we now know that the last-modified time of a <code class="language-plaintext highlighter-rouge">cache0000x.bin</code> file was correlated with the end of a session within 1 second. We can go back and use this to help us solve Task 8.</p> <h2 id="re-task-8-how-long-did-the-penultimate-rdp-session-last">Re: Task 8: How long did the penultimate RDP session last?</h2> <p>Based on Task 9, we’ll start with the idea that the <strong>session end time</strong> is the last-modified time of either <code class="language-plaintext highlighter-rouge">cache0000.bin</code> or <code class="language-plaintext highlighter-rouge">cache0002.bin</code>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/59a.png" sizes="95vw"></source> <img src="/assets/img/latus/59a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Considering that <code class="language-plaintext highlighter-rouge">cache0002.bin</code> was last modified on the 26th, we’ll go with <code class="language-plaintext highlighter-rouge">cache0000.bin</code> at <code class="language-plaintext highlighter-rouge">2024-06-28 13:40:21</code> (when converted to UTC) for the <strong>session end time</strong>.</p> <p>What about the <strong>session start time</strong>? At first I went back to the credential files. They looked really promising as they were last accessed at <code class="language-plaintext highlighter-rouge">2024-06-28 13:33:21</code>, making the session about 7 minutes long. Unfortunately none of the credentials’ timestamps worked to calculate the correct answer.</p> <p>Next I went back to Autopsy and the execution times. Unfortunately, none of the execution times of <code class="language-plaintext highlighter-rouge">mstsc.exe</code> seemed to make sense. However, I did end up noticing a sort of interesting correlation.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/43.png" sizes="95vw"></source> <img src="/assets/img/latus/43.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This shows an execution of mstsc.exe only about 25 seconds after our <strong>session end time</strong>. Perhaps this is the execution that precedes the final session from Task 9.</p> <p>Unfortunately we are still lacking a <strong>session start time</strong> for Task 8. Honestly, around this point I looked at a lot of options to see where I could maybe get more sources of information, but not too much was available. The registry write times weren’t helpful, the USN Journal wasn’t available in the evidence, I had reconstructed the images stored in the caches for Task 11 so I searched through them to see if I could see any timestamps (see Task 11 for details on these images).</p> <p>After a lot of searching I started just brute spraying any timestamps from $MFT of any files that seemed likely. I ended up hitting on the correct answer, but I don’t exactly understand why it is the correct answer. The timestamp for the session start time that ended up resulting in the correct answer was the <strong>last-access time of cach0002</strong>.</p> <p>I wanted to corroborate this time with some other timestamps, so I searched for any timestamps on either side of the one that resulted in the right answer to see if anything else came close and made more sense, but nothing came up.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/43a.png" sizes="95vw"></source> <img src="/assets/img/latus/43a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I do not know why the last-accessed time of an RDP cache marks the beginning of another. Perhaps when a session starts, the app accesses the last cache that it used to check if that cache can be used again for the new session.</p> <h2 id="task-10-what-is-the-size-of-the-remote-desktop-configured">Task 10: What is the size of the remote desktop configured?</h2> <p>I had already noticed this value while examining <strong>emman.t</strong>’s <code class="language-plaintext highlighter-rouge">Default.rdp</code>.</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/59b.png" sizes="95vw"></source> <img src="/assets/img/latus/59b.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-11-what-tool-did-attacker-use-to-discover-the-network-after-moving-laterally-to-19216870133">Task 11: What tool did attacker use to discover the network after moving laterally to 192.168.70.133?</h2> <p>For this task, we need to find out what happened on a <em>different machine</em>, other than the one the evidence image is from. After some fumbling around trying to look at console history, etc. I found that RDP caches store images of static parts of the machine that is the server in the connection. This is to reduce the amount of information that has to be sent over the network during the session, but it also leaves traces of what was done during the RDP session.</p> <p>I used <a href="https://medium.com/@ronald.craft/blind-forensics-with-the-rdp-bitmap-cache-16e0c202f91c" rel="external nofollow noopener" target="_blank">this post</a> by Ronald Craft as a guide for extracting images from the RDP cache. Per the instructions, I used <a href="https://github.com/ANSSI-FR/bmc-tools" rel="external nofollow noopener" target="_blank">BMC Tools</a> for extraction and <a href="https://github.com/brimorlabs/rdpieces" rel="external nofollow noopener" target="_blank">rdpieces</a> for reconstruction. The reason that reconstruction is necessary is that initially BMC Tools generates a bunch of very small image tiles, each of which doesn’t show much. Rdpieces attempts to stitch these back together into coherent images. However, I didn’t find that rdpieces worked very well. It was somewhat better than all the individual tiles, but not very good.</p> <p>It turns out though that BMC Tools’ option to create a collage of the times was the best way to get a look at all the images in the cache, at least for me. To do this, just use the <code class="language-plaintext highlighter-rouge">-b</code> option. BMC Tools outputs <em>a lot</em> of images, so I’d really suggest making an output dir for each cache you plan to extract from.</p> <p>In general:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bmc-tools.py <span class="nt">-s</span> cache_file.bin <span class="nt">-d</span> output_dir <span class="nt">-b</span>
</code></pre></div></div> <p>What it looked like for me:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bmc-tools/bmc-tools.py <span class="nt">-s</span> <span class="s2">"./C/[root]/Users/emman.t/AppData/Local/Microsoft/Terminal Server Client/Cache/Cache0001.bin"</span> <span class="nt">-d</span> cache0001 <span class="nt">-b</span>
</code></pre></div></div> <p>The image artifacts that result from this aren’t perfect, but they could contain interesting information. Here is part of one of the collages for example:</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/59c.png" sizes="95vw"></source> <img src="/assets/img/latus/59c.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>But which cache file should we look in? I looked at all of them, but there is a way to can figure out which one the answer should be in:</p> <p>This question asks about the tool used after moving laterally to 192.168.70.133. In Task 9 we found that the last session ended at a time that is correlated with the last-modified time of <strong>emman.t</strong>’s <code class="language-plaintext highlighter-rouge">Default.rdp</code>. The IP listed in that <code class="language-plaintext highlighter-rouge">Default.rdp</code> is 192.168.70.133, meaning that the last session whose end-time we found was connecting to 192.168.70.133. Given that knowledge, to look for a tool used on 192.168.70.133 we should look at the cache file that was last modified around that same time. Considering the last-modified times of the 3 cache files, one should stand out.</p> <p>After a lot of searching, I came across the name of the tool. It was clearly visible but broken into two parts.</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/63.png" sizes="95vw"></source> <img src="/assets/img/latus/63.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="task-12-when-was-the-event-log-deleted-by-the-attacker-utc">Task 12: When was the event log deleted by the attacker? (UTC)</h2> <p>Now, the attacker didn’t actually delete <em>all</em> the logs. Checking in <code class="language-plaintext highlighter-rouge">C:\Windows\System32\winevt\logs</code>, we can see a bunch of log files. Though many of them are empty, indicated by 68k size, some of them are not.</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/63a.png" sizes="95vw"></source> <img src="/assets/img/latus/63a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The powershell logs looked interesting, I used <a href="https://github.com/WithSecureLabs/chainsaw" rel="external nofollow noopener" target="_blank">Chainsaw</a> to query all the logs that existed in the logs directory and search for the word “powershell” like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chainsaw search <span class="nt">--timestamp</span> <span class="s1">'Event.System.TimeCreated_attributes.SystemTime'</span> <span class="nt">--to</span> <span class="s2">"2024-06-28T23:59:59"</span> <span class="nt">--skip-errors</span> <span class="s2">"powershell"</span> C/<span class="se">\[</span>root<span class="se">\]</span>/Windows/System32/winevt/Logs
</code></pre></div></div> <p>I could have isolated the search to the powershell logs, but I was interested to see if anything else would come back. Either way, this worked. There were only a few results and they definitely contain evidence of log destruction.</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/63b.png" sizes="95vw"></source> <img src="/assets/img/latus/63b.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The log excerpt above shows a command designed to loop through the log files and clear each one using <code class="language-plaintext highlighter-rouge">wevtutl.exe</code>, a tool used for managing windows event logs.</p> <h2 id="task-13-what-time-did-attacker-disconnect-session-to-19216870129-utc">Task 13: What time did attacker disconnect session to 192.168.70.129? (UTC)</h2> <p>Well, which machine is 192.168.70.129? Grepping for that IP through all the files in evidence turns up only one result: <code class="language-plaintext highlighter-rouge">C/[root]/Users/emman.t/AppData/Local/Microsoft/Edge/User Data/Default/Network/Network Persistent State</code>. This is a config file for Edge and contains the IP as part of its QUIC config, indicating that 192.168.70.129 is actually the local IP of the machine that the evidence was collected from.</p> <p>When did the attacker disconnect from this machine? Well, they must have disconnected <em>after</em> deleting the logs, so why not check the logs? I used chainsaw again to search for any logoff (event ID 4634) logs after the time the logs were deleted:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chainsaw search <span class="nt">--timestamp</span> <span class="s1">'Event.System.TimeCreated_attributes.SystemTime'</span> <span class="nt">--from</span> <span class="s2">"2024-06-27T14:03:25"</span> <span class="nt">--skip-errors</span> <span class="s2">"4634"</span> C/<span class="se">\[</span>root<span class="se">\]</span>/Windows/System32/winevt/Logs
</code></pre></div></div> <p>Six results are returned, but only 1 is a LogonType: 3 (network logon), while the others are type 2 (interactive). Assuming the attacker was logging on via network, I tried this timestamp and it was correct.</p> <div class="row mt-3"> <div class="col-sm-8 mt-3 mt-md-0 small-margin"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/latus/63c.png" sizes="95vw"></source> <img src="/assets/img/latus/63c.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="conclusion">Conclusion</h2> <p>This was an unconventional Sherlock for sure, but in some really amazing ways. The (near) lack of logs often forced me to think outside the box to retrieve information that would have normally been available in one log or another. This meant I had to do a significant amount of research to solve some tasks. I ended up learning a lot–even some entirely new (to me) techniques like extracting image artifacts from RDP caches–and learning is always my end goal for doing Sherlocks, so I was quite pleased with that.</p> <p>Another aspect of this Sherlock that I liked was that Task 5 (retrieving the credentials) requires the participants to take on the perspective of the attacker and use some offensive techniques in the name of forensics. It’s obvious that using offensive techniques to test defenses can help build better defenses, but it’s less obvious that directly using offensive techniques could be helpful in the investigation of an attack. I think this Sherlock does a great job highlighting the importance of being familiar with offensive skills no matter your role in cybersecurity.</p> <p>All in all, I really enjoyed completing this challenge and I can’t wait for the next one!</p> <p>Thanks for reading! If you have any questions or comments, feel free to reach out or follow <a href="https://x.com/its_rad_io" rel="external nofollow noopener" target="_blank">me on X</a></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/raspberryos_fan_control/">Fan Service</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/chrome_hx_volatility_plugin/">Chrome Browser History Plugin for Volatility 3</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Mellitus-Write-Up/">HTB Write-Up | Medium Sherlock | Mellitus</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Nuts-Write-Up/">HTB Write-Up | Medium Sherlock | Nuts</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/Compromised-Write-Up/">HTB Write-Up | Easy Sherlock | Compromised</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Edmund Hughes. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-blog",title:"blog",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-about",title:"about",description:"",section:"Navigation",handler:()=>{window.location.href="/about/"}},{id:"nav-people",title:"people",description:"",section:"Navigation",handler:()=>{window.location.href="/people/"}},{id:"post-fan-service",title:"Fan Service",description:"The fan on my RaspberryPi NAS & PiHole wouldn't stop running, so I built a custom solution.",section:"Posts",handler:()=>{window.location.href="/blog/2025/raspberryos_fan_control/"}},{id:"post-chrome-browser-history-plugin-for-volatility-3",title:"Chrome Browser History Plugin for Volatility 3",description:"A discription of a plugin I wrote for Volatility 3. The plugin searches for, extracts, and parses Google Chrome history databases in forensic memory images.",section:"Posts",handler:()=>{window.location.href="/blog/2025/chrome_hx_volatility_plugin/"}},{id:"post-htb-write-up-medium-sherlock-mellitus",title:"HTB Write-Up | Medium Sherlock | Mellitus",description:"A write-up for Hack The Box's forensics challenge 'Mellitus'. This challenge focuses primarily on memory forensics, with the evidence consisting solely of a forensic memory dump from a targeted machine.",section:"Posts",handler:()=>{window.location.href="/blog/2025/Mellitus-Write-Up/"}},{id:"post-htb-write-up-medium-sherlock-nuts",title:"HTB Write-Up | Medium Sherlock | Nuts",description:"A write-up for Hack The Box's forensics challenge 'Nuts'. This challenge focuses primarily on file forensics, with the evidence consisting solely of a forensic image of a targetted filesystem.",section:"Posts",handler:()=>{window.location.href="/blog/2025/Nuts-Write-Up/"}},{id:"post-htb-write-up-hard-sherlock-latus",title:"HTB Write-Up | Hard Sherlock | Latus",description:"A write-up for Hack The Box's forensics challenge 'Latus'",section:"Posts",handler:()=>{window.location.href="/blog/2024/latus-write-up/"}},{id:"post-htb-write-up-easy-sherlock-compromised",title:"HTB Write-Up | Easy Sherlock | Compromised",description:"A beginner-friendly write-up for Hack The Box's forensics challenge 'Compromised'",section:"Posts",handler:()=>{window.location.href="/blog/2024/Compromised-Write-Up/"}},{id:"post-how-to-implement-cmmc-at-your-organization",title:"How To Implement CMMC At Your Organization",description:"Basic considerations for what needs to be done to implement CMMC at any organization.",section:"Posts",handler:()=>{window.location.href="/blog/2024/CMMC-2.0-Implementation/"}},{id:"post-cmmc-2-0-is-important-for-the-dib-the-u-s-military-and-tax-payers-like-you-and-me",title:"CMMC 2.0 Is Important For The DIB, The U.S. Military, and Tax Payers...",description:"A short history of CMMC and the differences between CMMC 1.0 & 2.0",section:"Posts",handler:()=>{window.location.href="/blog/2024/CMMC-2.0-Summary/"}},{id:"post-how-chinese-spies-hacked-u-s-state-department-emails-threat-modeling-for-apts-and-aptaas",title:"How Chinese Spies Hacked U.S. State Department Emails--Threat Modeling for APTs and APTaaS...",description:"An informal discussion of Antique Typhoon's attack on Microsoft systems and email accounts associated with U.S Government personnel. A brief discussion of threat modelling and APTaaS.",section:"Posts",handler:()=>{window.location.href="/blog/2024/storm-0558-APT/"}},{id:"post-the-legal-implications-of-antique-typhoon-39-s-intrusion-into-microsoft-amp-the-u-s-state-department",title:"The Legal Implications of Antique Typhoon's Intrusion Into Microsoft & The U.S. State...",description:"An informal discussion of Antique Typhoon's attack on Microsoft systems and email accounts associated with U.S State Department employees as well as the laws that were likely broken along the way.",section:"Posts",handler:()=>{window.location.href="/blog/2024/storm-0558-laws/"}},{id:"post-why-all-the-cybersecurity-laws-why-now",title:"Why All The Cybersecurity Laws? Why Now?",description:"A short piece I wrote for a Cyberlaw class on the importance of cybersecurity laws in the modern day.",section:"Posts",handler:()=>{window.location.href="/blog/2024/importance-of-cyberlaw/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%69%74%73%72%61%64.%69%6F.%70%72%69%76%61%63%79@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=qc6CJjYAAAAJ","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>